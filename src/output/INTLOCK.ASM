	ifndef	??version
?debug	macro
	endm
publicdll macro	name
	public	name
	endm
$comm	macro	name,dist,size,count
	comm	dist name:BYTE:count*size
	endm
	else
$comm	macro	name,dist,size,count
	comm	dist name[size]:BYTE:count
	endm
	endif
	?debug	V 300h
	?debug	S "intlock.cpp"
	?debug	C E9B563B64E0B696E746C6F636B2E637070
	?debug	C E9B563B64E0E2E2E5C685C696E744C6F636B2E68
	?debug	C E97B70A2500D2E2E5C685C5468726561642E68
INTLOCK_TEXT	segment byte public 'CODE'
INTLOCK_TEXT	ends
	assume	cs:INTLOCK_TEXT,ds:INTLOCK_DATA
INTLOCK_DATA	segment word public 'FAR_DATA'
d@	label	byte
d@w	label	word
b@	label	byte
b@w	label	word
_mutex_glb	label	word
	db	1
	db	0
INTLOCK_DATA	ends
INTLOCK_TEXT	segment byte public 'CODE'
	?debug	C E8010B696E746C6F636B2E637070B563B64E
   ;	
   ;	void mutex_glb_wait(){
   ;	
	?debug	L 5
	assume	cs:INTLOCK_TEXT
@mutex_glb_wait$qv	proc	far
	?debug	B
	push	bp
	mov	bp,sp
	push	ds
	mov	ax,INTLOCK_DATA
	mov	ds,ax
@1@30:
	?debug	B
   ;	
   ;	 sloop:asm{
   ;		mov ax, 0
   ;	
	?debug	L 7
	mov	 ax, 0
   ;	
   ;		xchg ax, mutex_glb 	
   ;	
	?debug	L 8
	xchg	 ax, _mutex_glb 	
   ;	
   ;	}
   ;	 if(_AX ==0){
   ;	
	?debug	L 10
	or	ax,ax
	jne	short @1@142
   ;	
   ;		dispatch();
   ;	
	?debug	L 11
	call	far ptr @dispatch$qv
   ;	
   ;		asm jmp sloop;
   ;	
	?debug	L 12
	jmp	short @1@30
@1@142:
   ;	
   ;	 }
   ;	}
   ;	
	?debug	L 14
	pop	ds
	pop	bp
	ret	
	?debug	E
	?debug	E
@mutex_glb_wait$qv	endp
	?debug	C E9
	?debug	C FA00000000
INTLOCK_TEXT	ends
INTLOCK_DATA	segment word public 'FAR_DATA'
s@	label	byte
INTLOCK_DATA	ends
INTLOCK_TEXT	segment byte public 'CODE'
INTLOCK_TEXT	ends
	public	@mutex_glb_wait$qv
	public	_mutex_glb
	extrn	@dispatch$qv:far
_s@	equ	s@
	?debug	C EA050D
	?debug	C E31800000023010400
	?debug	C EC12406D757465785F676C625F77616974247176+
	?debug	C 181800
	?debug	C EC0A5F6D757465785F676C62040000
	?debug	C E31900000023010400
	?debug	C EB0C4064697370617463682471761900
	?debug	C E31A0654687265616408002E01
	?debug	C ED00010000010E00
	?debug	C E31B0000002D0104011A00114054687265616440+
	?debug	C 307374617274247176
	?debug	C E31D0000002D0104011A001A4054687265616440+
	?debug	C 3077616974546F436F6D706C657465247176
	?debug	C E31F0000002D0104011A00114054687265616440+
	?debug	C 302462647472247176
	?debug	C E3210000002D0404011A00114054687265616440+
	?debug	C 306765744964247176
	?debug	C E3230000002D0404011A00184054687265616440+
	?debug	C 3067657452756E6E696E674964247176
	?debug	C E325000400161A00
	?debug	C E3260000002D2504011A00194054687265616440+
	?debug	C 3067657454687265616442794964247169
	?debug	C E3280000002D0104011A00134054687265616440+
	?debug	C 307369676E616C24717569
	?debug	C E32A0000002D0104011A00214054687265616440+
	?debug	C 30726567697374657248616E646C657224717569+
	?debug	C 6E71762476
	?debug	C E32C0000002D0104011A00224054687265616440+
	?debug	C 30756E7265676973746572416C6C48616E646C65+
	?debug	C 727324717569
	?debug	C E32E0000002D0104011A00184054687265616440+
	?debug	C 3073776170247175696E717624767432
	?debug	C E3300000002D0104011A00184054687265616440+
	?debug	C 30626C6F636B5369676E616C24717569
	?debug	C E3320000002D0104011A00204054687265616440+
	?debug	C 30626C6F636B5369676E616C476C6F62616C6C79+
	?debug	C 24717569
	?debug	C E3340000002D0104011A001A4054687265616440+
	?debug	C 30756E626C6F636B5369676E616C24717569
	?debug	C E3360000002D0104011A00224054687265616440+
	?debug	C 30756E626C6F636B5369676E616C476C6F62616C+
	?debug	C 6C7924717569
	?debug	C E3380000002D2504011A00144054687265616440+
	?debug	C 3024626374722471756C7569
	?debug	C E33A0000002D0104091A02
	?debug	C E33C000400160100
	?debug	C E6085369676E616C49640A060002494404060004+
	?debug	C 54696D650A060009537461636B53697A650C0600+
	?debug	C 065468726561641A070003504342010700
	?debug	C E248114054687265616440307374617274247176+
	?debug	C 1B481A40546872656164403077616974546F436F+
	?debug	C 6D706C6574652471761D4D114054687265616440+
	?debug	C 3024626474722471761F48114054687265616440+
	?debug	C 3067657449642471762148184054687265616440+
	?debug	C 3067657452756E6E696E67496424717623481940+
	?debug	C 5468726561644030676574546872656164427949+
	?debug	C 642471692648134054687265616440307369676E+
	?debug	C 616C247175692848214054687265616440307265+
	?debug	C 67697374657248616E646C6572247175696E7176+
	?debug	C 24762A4822405468726561644030756E72656769+
	?debug	C 73746572416C6C48616E646C657273247175692C+
	?debug	C 481840546872656164403073776170247175696E+
	?debug	C 7176247674322E4818405468726561644030626C+
	?debug	C 6F636B5369676E616C2471756930482040546872+
	?debug	C 6561644030626C6F636B5369676E616C476C6F62+
	?debug	C 616C6C792471756932481A405468726561644030+
	?debug	C 756E626C6F636B5369676E616C24717569344822+
	?debug	C 405468726561644030756E626C6F636B5369676E+
	?debug	C 616C476C6F62616C6C7924717569364A14405468+
	?debug	C 72656164403024626374722471756C7569384C0F+
	?debug	C 40546872656164403072756E2471763A40040000+
	?debug	C 0000056D795043423CC008000000
	end
